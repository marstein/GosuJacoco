<?xml version="1.0" encoding="UTF-8"?>

<project name="org.jacoco.ant.tests.buildhook" xmlns:au="antlib:org.apache.ant.antunit" basedir=".">
	
	<property name="do.compile" value="true"/>
	<property name="do.customverify" value="true"/>
	
	<path id="dependencies">
		<path refid="bundle-org.junit4"/>
	</path>
		
	<taskdef uri="antlib:org.apache.ant.antunit" resource="org/apache/ant/antunit/antlib.xml">
		<classpath>
			<fileset dir="${source.bundle.dir}/ant/lib" includes="*.jar"/>
		</classpath>
	</taskdef>
	
	<target name="customverify">
		<property name="result.dist.bundle.jar.file" location="${result.dist.lib.dir}/${manifest.Bundle-SymbolicName}_${qualified.bundle.version}.jar"/>
		<property name="result.tmp.bundle.test.dir" location="${result.tmp.bundle.dir}/test"/>
		<mkdir dir="${result.tmp.bundle.test.dir}"/>

	    <au:antunit failonerror="true">
	    	<propertyset>
	    		<propertyref name="result.dist.lib.dir"/>
	    		<propertyref name="result.tmp.bundle.classes.dir"/>
	    		<propertyref name="target.plugins.dir"/>
	    	</propertyset>
	    	
	      	<fileset dir="${source.bundle.dir}/ant" includes="*.xml"/>
	    	<!-- The XML Listener is broken in a few ways:
	    	     Attempts to create package names for the tests, but only works if tests are under the base dir
	    	     XML result is not parseable by the eclipse junit framework
	    	-->
	    	<!--
			<au:xmllistener todir="${result.tmp.bundle.test.dir}" loglevel="info"/>
	    	-->
	    	<au:plainlistener sendLogTo="ant" logLevel="info"/>
	    </au:antunit>

	</target>
</project>