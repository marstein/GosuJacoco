<?xml version="1.0" encoding="UTF-8"?>

<project name="org.jacoco.ant.tests.buildhook" xmlns:au="antlib:org.apache.ant.antunit" xmlns:jacoco="antlib:org.jacoco.ant" basedir=".">
	
	<property name="do.compile" value="true"/>
	<property name="do.customverify" value="true"/>
	
	<path id="dependencies">
		<path refid="bundle-org.junit4"/>
	</path>
		
	<taskdef uri="antlib:org.apache.ant.antunit" resource="org/apache/ant/antunit/antlib.xml">
		<classpath>
			<fileset dir="${source.bundle.dir}/ant/lib" includes="*.jar"/>
		</classpath>
	</taskdef>
	
	<taskdef uri="antlib:org.jacoco.ant" resource="org/jacoco/ant/antlib.xml">
		<classpath>
			<file file="${result.dist.lib.dir}/jacocoant.jar"/>
		</classpath>
	</taskdef>
	
	<target name="customverify">
		<property name="result.dist.bundle.jar.file" location="${result.dist.lib.dir}/${manifest.Bundle-SymbolicName}_${qualified.bundle.version}.jar"/>
		<property name="result.tmp.bundle.test.dir" location="${result.tmp.bundle.dir}/test"/>
		<property name="result.tmp.bundle.testdata.dir" location="${result.tmp.bundle.dir}/testdata"/>
		
		<mkdir dir="${result.tmp.bundle.test.dir}"/>

		<jacoco:coverage
				merge="true"
				file="${result.tmp.coverage.file}">
			<java fork="true" jar="${ant.library.dir}/ant-launcher.jar" failonerror="true">
				<arg value="-f"/>
				<arg value="${source.bundle.dir}/ant/stub.xml"/>
				<arg value="-Dresult.dist.lib.dir=${result.dist.lib.dir}"/>
				<arg value="-Dresult.tmp.bundle.testdata.dir=${result.tmp.bundle.testdata.dir}"/>
				<arg value="-Dresult.tmp.bundle.classes.dir=${result.tmp.bundle.classes.dir}"/>
				<arg value="-Dtarget.plugins.dir=${target.plugins.dir}"/>
			</java>
		</jacoco:coverage>

	</target>
</project>