<?xml version="1.0" encoding="UTF-8"?>

<project name="org.jacoco.doc.buildhook" xmlns:jacoco="antlib:org.jacoco.ant">

	<property name="do.customverify" value="true"/>
	<property name="do.customdoc" value="true"/>
	
	<target name="customverify">
		<!-- Test Report -->
		<mkdir dir="${result.dist.test.dir}"/>
		<junitreport todir="${result.dist.test.dir}">
			<fileset dir="${result.tmp.dir}" includes="*/test/*.xml"/>
			<report format="noframes" todir="${result.dist.test.dir}"/>
		</junitreport>
		<move file="${result.dist.test.dir}/junit-noframes.html"  
			  tofile="${result.dist.test.dir}/index.html"/>
		
		<!-- Coverage Report -->
		<taskdef uri="antlib:org.jacoco.ant" resource="org/jacoco/ant/antlib.xml">
			<classpath>
				<file file="${result.dist.lib.dir}/jacocoant.jar"/>
			</classpath>
		</taskdef>
		
		<mkdir dir="${result.dist.coverage.dir}"/>
		<jacoco:report>
			<executiondata>
				<file file="${result.tmp.coverage.file}"/>
			</executiondata>
			<structure name="JaCoCo">
				<group name="org.jacoco.agent">
					<classfiles>
						<path refid="bundle-org.jacoco.agent"/>
					</classfiles>
					<sourcefiles>
						<fileset dir="${workspace.dir}/org.jacoco.agent/src" includes="**/*.java"/>
					</sourcefiles>
				</group>
				<group name="org.jacoco.ant">
					<classfiles>
						<path refid="bundle-org.jacoco.ant"/>
					</classfiles>
					<sourcefiles>
						<fileset dir="${workspace.dir}/org.jacoco.ant/src" includes="**/*.java"/>
					</sourcefiles>
				</group>
				<group name="org.jacoco.core">
					<classfiles>
						<path refid="bundle-org.jacoco.core"/>
					</classfiles>
					<sourcefiles>
						<fileset dir="${workspace.dir}/org.jacoco.core/src" includes="**/*.java"/>
					</sourcefiles>
				</group>
				<group name="org.jacoco.report">
					<classfiles>
						<path refid="bundle-org.jacoco.report"/>
					</classfiles>
					<sourcefiles>
						<fileset dir="${workspace.dir}/org.jacoco.report/src" includes="**/*.java"/>
					</sourcefiles>
				</group>
			</structure>
			<html todir="${result.dist.coverage.dir}"
				  footer="Code Coverage Report for JaCoCo ${qualified.bundle.version}"/>
			<csv todir="${result.dist.coverage.dir}"/>
		</jacoco:report>
	</target>
	
	
	<target name="customdoc">
		
		<javadoc destdir="${result.dist.dir}/doc/api"
			windowtitle="JaCoCo ${qualified.bundle.version}"
			overview="${source.bundle.dir}/javadoc/overview.html">
			<sourcefiles>
				<fileset dir="${source.bundle.dir}/../org.jacoco.core/src" includes="**/*.java"/>
				<fileset dir="${source.bundle.dir}/../org.jacoco.report/src" includes="**/*.java"/>
			</sourcefiles>
			<classpath>
				<path refid="bundle-org.objectweb.asm"/>
			</classpath>
			<group title="Bundle org.jacoco.core" packages="org.jacoco.core*"/>
			<group title="Bundle org.jacoco.report" packages="org.jacoco.report*"/>
			<link href="http://java.sun.com/j2se/1.5.0/docs/api" offline="true" packagelistloc="${source.bundle.dir}/javadoc/java"/>
			<link href="http://asm.ow2.org/asm31/javadoc/user" offline="true" packagelistloc="${source.bundle.dir}/javadoc/asm"/>
		</javadoc>
		
		<copy todir="${result.dist.dir}">
			<fileset dir="${source.bundle.dir}/docroot" includes="**/*" excludes="**/*.html"/>
		</copy>

		<copy todir="${result.dist.dir}">
			<fileset dir="${source.bundle.dir}/docroot" includes="**/*.html"/>
			<filterset>
				<filter token="VERSION" value="${qualified.bundle.version}"/>
				<filter token="HOMEURL" value="${jacoco.home.url}"/>
			</filterset>
		</copy>
		
	</target>
	
</project>